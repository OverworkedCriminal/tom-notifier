# Tom-Notifier-WS-Delivery

Part of tom-notifier system responsible for delivering notifications
using websocket connections.

#### Main features
- delivering notifications produced by tom-notifier-core
- redelivering notifications that were not responded to
- producing confirmations for tom-notifier-core
- (uni/multi/broad)cast deliveries
- RabbitMQ integration
    - consuming - notifications published to
    `TOM_NOTIFIER_WS_DELIVERY_RABBITMQ_NOTIFICATIONS_EXCHANGE_NAME` exchange are consumed from
    `TOM_NOTIFIER_WS_DELIVERY_RABBITMQ_NOTIFICATIONS_QUEUE_NAME` and then delivered to connected users
    - producing - response to any `NEW` message creates confirmation that will be
    published to `TOM_NOTIFIER_WS_DELIVERY_RABBITMQ_CONFIRMATIONS_EXCHANGE_NAME` exchange
- ability to close all connections that belong to selected user ()



## Endpoints



### GET  `/api/v1/ticket`
Fetch single use ticket that can be used to establish
WebSocket connection with the server

#### Response on success
```
{
    ticket: String,
}
```
#### Response Code
| Status code | when? |
| --- | --- |
| 200 | success |




### DELETE `/api/v1/connection/:user_id`
Close all connections bound to passed user_id.

Requires `tom_notifier_admin` role.
#### Path
| param | description |
| --- | --- |
| user_id | user_id whose connections should be closed |
#### Response Code
| Status code | when? |
| --- | --- |
| 204 | success |
| 403 | user lacks role `tom_notifier_admin` |




### GET `/ws/v1`
Websocket upgrade endpoints.

#### Params
| param | description |
| --- | --- |
| ticket | single use ticket generated by the server before establishing connection |
#### Response Code
| Status code | when? |
| --- | --- |
| 401 | - ticket does not exist <br> - ticket has already been used <br> - ticket has expired |
